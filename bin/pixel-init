#! /bin/bash

echo -e "INIT\t: updating apt..."
sudo apt-get upgrade
sudo apt-get update

cd /home/pixel
#ln -sf /home/pixel/pixel/bin /home/pixel/bin
ln -sf ~/pixel/vimrc .vimrc
ln -sf ~/pixel/tmux.conf .tmux.conf
ln -sf ~/pixel/indent.pro .indent.pro
ln -sf ~/pixel/astyle.rc .astylerc

type mkpasswd >& /dev/null
RC=$?; if [ "$RC" == "0" ]; then
    echo -e "INIT\t: whois installed"
else
    sudo apt-get install -y whois
fi

type vue >& /dev/null
RC=$?; if [ "$RC" == "0" ]; then
    echo -e "INIT\t: vue installed"
else
    sudo npm install -g -y vue-cli
fi

type cross-env >& /dev/null
RC=$?; if [ "$RC" == "0" ]; then
    echo -e "INIT\t: cross-env installed"
else
    sudo npm install -g -y cross-env
fi

type rimraf >& /dev/null
RC=$?; if [ "$RC" == "0" ]; then
    echo -e "INIT\t: rimraf installed"
else
    sudo npm install -g -y rimraf
fi

type concurrently >& /dev/null
RC=$?; if [ "$RC" == "0" ]; then
    echo -e "INIT\t: concurrently installed"
else
    sudo npm install -g -y concurrently
fi

type vim >& /dev/null
RC=$?; if [ "$RC" == "0" ]; then
    echo -e "INIT\t: vim installed"
else
    sudo apt-get install -y vim
fi

type nslookup >& /dev/null
RC=$?; if [ "$RC" == "0" ]; then
    echo -e "INIT\t: nslookup installed"
else
    sudo apt-get install -y dnsutils
fi

type tmux >& /dev/null
RC=$?; if [ "$RC" == "0" ]; then
    echo -e "INIT\t: tmux installed"
else
    sudo apt-get install -y tmux
fi

type curl >& /dev/null
RC=$?; if [ "$RC" == "0" ]; then
    echo -e "INIT\t: curl installed"
else
    sudo apt-get install -y curl
fi

type sqlite3 >& /dev/null
RC=$?; if [ "$RC" == "0" ]; then
    echo -e "INIT\t: sqlite3 installed"
else
    sudo apt-get install -y sqlite3
fi

type git >& /dev/null
RC=$?; if [ "$RC" == "0" ]; then
    echo -e "INIT\t: git installed"
else
    sudo apt-get install -y git
fi
git config --global user.email "karl@firepick.org"
git config --global user.name "Karl Lew"
git config --global push.default simple

type nodejs >& /dev/null
RC=$?; if [ "$RC" == "0" ]; then
    echo -e "INIT\t: nodejs installed"
else
    curl -sL https://deb.nodesource.com/setup_8.x | sudo -E bash -
    sudo apt-get install -y nodejs
    sudo apt-get install -y build-essential
fi

type mocha >& /dev/null
RC=$?; if [ "$RC" == "0" ]; then
    echo -e "INIT\t: mocha installed"
else
    sudo npm install -g -y mocha
fi

type rg >& /dev/null
RC=$?; if [ "$RC" == "0" ]; then
    echo -e "INIT\t: ripgrep installed"
else
    curl -LO https://github.com/BurntSushi/ripgrep/releases/download/11.0.2/ripgrep_11.0.2_amd64.deb
    sudo dpkg -i ripgrep_11.0.2_amd64.deb
fi

if [ -e .bashrc ]; then
    cmp .bashrc pixel/.bashrc
    RC=$?; if [ "$RC" != "0" ]; then
        mv -f .bashrc .bashrc.old
    fi
fi
ln -sf ~/pixel/.bashrc .bashrc
echo -e "INIT\t: exit and re-enter chroot to verify setup"

echo -e "INIT\t: pixel initialized"
